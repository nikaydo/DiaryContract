syntax = "proto3";

package auth;   

import "google/protobuf/timestamp.proto";

option go_package = "github.com/nikaydo/DiaryAuth;auth";

service Auth{
    rpc SignUp (SignUpRequest) returns (SignUpResponse);
    rpc SignIn (SignInRequest) returns (SignInResponse);

    rpc OauthGoogleUrl (OauthGoogleUrlRequest) returns (OauthGoogleUrlResponse);
    rpc OauthGoogle (OauthGoogleRequest) returns (OauthGoogleResponse);

    rpc ValidateToken (ValidateTokenRequest) returns (ValidateTokenResponse);

    rpc ProfileGet (ProfileGetRequest) returns (ProfileGetResponse);
    rpc ProfileUpdate (ProfileUpdateRequest) returns (ProfileUpdateResponse);
    rpc PreferencesUpdate (PreferencesUpdateRequest) returns (PreferencesUpdateResponse);

    rpc PasswordReset (PasswordResetRequest) returns (PasswordResetResponse);
    rpc LoginSet (LoginSetRequest) returns (LoginSetResponse);
  
    rpc Prepare2FA(Prepare2FARequest) returns (Prepare2FAResponse);
    rpc Setup2FA(Setup2FARequest) returns (Setup2FAResponse);
    rpc Validate2FA(Validate2FARequest) returns (Validate2FAResponse);
    
    rpc RecoveryGen(RecoveryGenRequest) returns (RecoveryGenResponse);
    rpc RecoveryCheck(RecoveryCheckRequest) returns (RecoveryCheckResponse);
} 

message LoginSetRequest{
  string userid = 1;
  string password = 2;
  string newLogin = 3;
}

message LoginSetResponse{
  bool status =1;
}

message PasswordResetRequest{
  string newPassword = 1;
  string oldPassword = 2;
  string code = 3;
  string userid = 4;
}

message PasswordResetResponse{
  bool status =1;
}

//2FA
message Setup2FARequest{
  string userid =1;
  string code = 2;
}

message Setup2FAResponse{
  bool status =1;
}

message Prepare2FARequest{
  string userid =1;
}
message Prepare2FAResponse{
  string url =1;
}

message Validate2FARequest{
  string code =1;
  string userid =2;
  string login =3;
}

message Validate2FAResponse{
  bool status =1;
  string jwtToken = 2;
}
//2FA
//Recovery code
message RecoveryGenRequest{
  string userid =1;
}

message RecoveryGenResponse{
  RecoveryWords words =1;
}
message RecoveryCheckRequest{
  string userid =1;
  RecoveryWords words =2;
  
}

message RecoveryCheckResponse{
  string status =1;
}

message RecoveryWords {
  string one =1;
  string two =2;
  string three =3;
  string four =4;
  string five =5;
}

//Recovery code
//Oauth2
message OauthGoogleRequest{
  string code =1;
  string state =2;
  string url = 3;
  string userid = 4;
}

message OauthGoogleResponse{
  string userid = 1;
  string jwtToken = 2;
}

message OauthGoogleUrlRequest{
  string url = 1;
}

message OauthGoogleUrlResponse{
  string url = 1;
}
//Oauth2
//Auth
message SignUpRequest {
  User user = 1;
}

message SignUpResponse {
  //uuid user
  string userid = 1;
  //jwt token
  string jwtToken = 2;
}

message SignInRequest {
  User user = 1;
}

message SignInResponse {
  //uuid user
  string userid = 1;
  //jwt token
  string jwtToken = 2;

  bool ThowFA =3;
}

message User {
  string login = 1;
  string password = 2;
  string userid =3;
}

message ValidateTokenRequest {
  //uuid user
  string userid = 1;
  //jwt token
  string jwtToken = 2;
}

message ValidateTokenResponse {
  //Jwt token in have write uuid if token valid return uuid 
  string userid = 1;
  //retrunring jwt token if token in requests valid
  string jwtToken = 2; 
  //if token expaired return jwt token and true 
  bool isExpaired = 3;
}
//Auth

message ProfileGetRequest{
  string userid = 1;
}

message ProfileGetResponse{
  string status = 1; 
  Profile profile = 2;
}

message ProfileUpdateRequest{
  string userid = 1;
  Profile profile = 2;
}

message ProfileUpdateResponse{
  string status = 1; 
}

message PreferencesUpdateRequest{
  string userid = 1;
  Preferences preferences = 2;
}

message PreferencesUpdateResponse{
  string status = 1; 
}

message Profile {
  string userid = 1;
  string username = 3;
  string displayName = 4;
  string avatar = 5;
  Preferences preferences = 6;
  google.protobuf.Timestamp createdAt = 7;
  Exist Exist = 8;
}

message Exist {
  bool twoFactorEnable = 1;
  bool oauth2Google = 2;
  bool passExist = 3;
  bool loginExist = 4;
}
message Preferences {
  string userid = 1;
  string theme = 2;
  string language = 3;
}
