syntax = "proto3";

package auth;   

import "google/protobuf/timestamp.proto";

option go_package = "github.com/nikaydo/DiaryAuth;auth";

service Auth{
    rpc SignUp (SignUpRequest) returns (SignUpResponse);
    rpc SignIn (SignInRequest) returns (SignInResponse);

    rpc OauthGoogleUrl (OauthGoogleUrlRequest) returns (OauthGoogleUrlResponse);
    rpc OauthGoogle (OauthGoogleRequest) returns (OauthGoogleResponse);

    rpc ValidateToken (ValidateTokenRequest) returns (ValidateTokenResponse);

    rpc ProfileGet (ProfileGetRequest) returns (ProfileGetResponse);
    rpc ProfileUpdate (ProfileUpdateRequest) returns (ProfileUpdateResponse);
    rpc PreferencesUpdate (PreferencesUpdateRequest) returns (PreferencesUpdateResponse);
    rpc NotificationUpdate (NotificationUpdateRequest) returns (NotificationUpdateResponse);
    rpc DiarySettingsUpdate (DiarySettingsUpdateRequest) returns (DiarySettingsUpdateResponse);

    rpc Enable2FA(Enable2FARequest) returns (Enable2FAResponse);
    rpc Setup2FA(Setup2FARequest) returns (Setup12FAResponse);
    rpc Validate2FA(Validate2FARequest) returns (Validate2FAResponse);
    
    rpc RecoveryGen(RecoveryGenRequest) returns (RecoveryGenResponse);
    rpc RecoveryCheck(RecoveryCheckRequest) returns (RecoveryCheckResponse);
    rpc RecoveryGet(RecoveryGetRequest) returns (RecoveryGetResponse);
} 
//2FA
message Setup2FARequest{
  string userid =1;
}

message Setup12FAResponse{
  string url =1;
}

message Enable2FARequest{
  string userid =1;
  
}
message Enable2FAResponse{
  string status =1;
}

message Validate2FARequest{
  string code =1;
  string userid =2;
}

message Validate2FAResponse{
  bool status =1;
}
//2FA
//Recovery code
message RecoveryGenRequest{
  string userid =1;
  
}

message RecoveryGenResponse{
  string status =1;
}


message RecoveryCheckRequest{
  string code =1;
  
}

message RecoveryCheckResponse{
  string status =1;
}

message RecoveryGetRequest{
  string userid =1;
  
}

message RecoveryGetResponse{
  repeated string code =1;
}
//Recovery code
//Oauth2
message OauthGoogleRequest{
  string code =1;
  string state =2;
  string url = 3;
}

message OauthGoogleResponse{
  string userid = 1;
  string jwtToken = 2;
}

message OauthGoogleUrlRequest{
  string url = 1;
}

message OauthGoogleUrlResponse{
  string url = 1;
}
//Oauth2
//Auth
message SignUpRequest {
  User user = 1;
}

message SignUpResponse {
  //uuid user
  string userid = 1;
  //jwt token
  string jwtToken = 2;
}

message SignInRequest {
  User user = 1;
}

message SignInResponse {
  //uuid user
  string userid = 1;
  //jwt token
  string jwtToken = 2;
}

message User {
  string login = 1;
  string password = 2;
  string email = 3;
}

message ValidateTokenRequest {
  //uuid user
  string uuid = 1;
  //jwt token
  string jwtToken = 2;
}

message ValidateTokenResponse {
  //Jwt token in have write uuid if token valid return uuid 
  string userid = 1;
  //retrunring jwt token if token in requests valid
  string jwtToken = 2; 
  //if token expaired return jwt token and true 
  bool isExpaired = 3;
}
//Auth

message ProfileGetRequest{
  string userid = 1;
}

message ProfileGetResponse{
  string status = 1; 
  Profile profile = 2;
}

message ProfileUpdateRequest{
  string userid = 1;
  Profile profile = 2;
}

message ProfileUpdateResponse{
  string status = 1; 
}

message PreferencesUpdateRequest{
  string userid = 1;
  Preferences preferences = 2;
}

message PreferencesUpdateResponse{
  string status = 1; 
}

message NotificationUpdateRequest{
  string userid = 1;
  Notifications notifications = 2;
}

message NotificationUpdateResponse{
  string status = 1; 
}

message DiarySettingsUpdateRequest{
  string userid = 1;
  DiarySettings diarySettings = 2;
}

message DiarySettingsUpdateResponse{
  string status = 1; 
}

message Profile {
  string userid = 1;
  string username = 3;
  string displayName = 4;
  string avatar = 5;
  Preferences preferences = 6;
  google.protobuf.Timestamp createdAt = 7;
}

message Preferences {
  string userid = 1;
  string theme = 2;
  string language = 3;
  string timezone = 4;
  DiarySettings diarySettings = 5;
  Notifications notifications = 6;
}

message DiarySettings {
  bool autoSave = 1;
  bool showThumbnails = 2;
}

message Notifications {
  bool push = 1;
  bool reminders = 2;
}